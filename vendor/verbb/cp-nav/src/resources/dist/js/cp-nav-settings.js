!function(t){void 0===Craft.CpNav&&(Craft.CpNav={});var e=new Craft.AdminTable({tableSelector:"#layoutItems",sortable:!0,reorderAction:"cp-nav/layout/reorder",deleteAction:"cp-nav/layout/delete",confirmDeleteMessage:Craft.t("cp-nav","Are you sure you want to permanently delete this layout and all its settings? This cannot be undone.")});t(document).on("click","tr.layout-item a.edit-layout",(function(e){new Craft.CpNav.EditLayoutItem(t(this),t(this).parents("tr.layout-item"))})),Craft.CpNav.EditLayoutItem=Garnish.Base.extend({$element:null,data:null,layoutId:null,$form:null,$spinner:null,hud:null,init:function(e,a){this.$element=e,this.data={id:a.data("id")},this.$element.addClass("loading"),Craft.postActionRequest("cp-nav/layout/get-hud-html",this.data,t.proxy(this,"showHud"))},showHud:function(e,a){if(this.$element.removeClass("loading"),"success"===a){var s=t();this.$form=t("<div/>"),$fieldsContainer=t('<div class="fields"/>').appendTo(this.$form),$fieldsContainer.html(e.html),Craft.initUiElements($fieldsContainer);var i=t('<div class="hud-footer"/>').appendTo(this.$form),n=t('<div class="buttons right"/>').appendTo(i);this.$cancelBtn=t('<div class="btn">'+Craft.t("app","Cancel")+"</div>").appendTo(n),this.$saveBtn=t('<input class="btn submit" type="submit" value="'+Craft.t("app","Save")+'"/>').appendTo(n),this.$spinner=t('<div class="spinner hidden"/>').appendTo(n),s=s.add(this.$form),this.hud=new Garnish.HUD(this.$element,s,{bodyClass:"body",closeOtherHUDs:!1}),this.hud.on("hide",t.proxy(this,"closeHud")),Garnish.$bod.append(e.footerJs),this.addListener(this.$saveBtn,"click","save"),this.addListener(this.$cancelBtn,"click","closeHud")}},save:function(e){e.preventDefault(),this.$spinner.removeClass("hidden");var a=this.hud.$body.serialize();Craft.postActionRequest("cp-nav/layout/save",a,t.proxy((function(t,e){this.$spinner.addClass("hidden"),"success"===e&&t.success?(this.$element.html("<strong>"+t.layout.name+"</strong>"),Craft.cp.displayNotice(Craft.t("cp-nav","Layout saved.")),this.closeHud()):(Craft.cp.displayError(t.error),Garnish.shake(this.hud.$hud))}),this))},closeHud:function(){this.hud.$shade.remove(),this.hud.$hud.remove()}}),t(document).on("click",".add-new-layout",(function(e){e.preventDefault(),new Craft.CpNav.CreateLayoutItem(t(this))})),Craft.CpNav.CreateLayoutItem=Garnish.Base.extend({$element:null,data:null,layoutId:null,$form:null,$spinner:null,hud:null,init:function(e){this.$element=e,this.$element.addClass("loading"),Craft.postActionRequest("cp-nav/layout/get-hud-html",{},t.proxy(this,"showHud"))},showHud:function(e,a){if(this.$element.removeClass("loading"),"success"===a){var s=t();this.$form=t("<div/>"),$fieldsContainer=t('<div class="fields"/>').appendTo(this.$form),$fieldsContainer.html(e.html),Craft.initUiElements($fieldsContainer);var i=t('<div class="hud-footer"/>').appendTo(this.$form),n=t('<div class="buttons right"/>').appendTo(i);this.$cancelBtn=t('<div class="btn">'+Craft.t("app","Cancel")+"</div>").appendTo(n),this.$saveBtn=t('<input class="btn submit" type="submit" value="'+Craft.t("app","Save")+'"/>').appendTo(n),this.$spinner=t('<div class="spinner hidden"/>').appendTo(n),s=s.add(this.$form),this.hud=new Garnish.HUD(this.$element,s,{bodyClass:"body",closeOtherHUDs:!1}),this.hud.on("hide",t.proxy(this,"closeHud")),Garnish.$bod.append(e.footerJs),this.addListener(this.$saveBtn,"click","save"),this.addListener(this.$cancelBtn,"click","closeHud")}},save:function(a){a.preventDefault(),this.$spinner.removeClass("hidden");var s=this.hud.$body.serialize();Craft.postActionRequest("cp-nav/layout/new",s,t.proxy((function(t,a){if(this.$spinner.addClass("hidden"),"success"===a&&t.success){Craft.cp.displayNotice(Craft.t("cp-nav","Layout created."));var s=t.layouts,i=e.addRow('<tr class="layout-item" data-id="'+s.id+'" data-name="'+s.name+'"><td><a class="edit-layout"><strong>'+s.name+'</strong></a></td><td class="thin"><a class="move icon" title="'+Craft.t("app","Reorder")+'" role="button"></a></td><td class="thin"><a class="delete icon" title="'+Craft.t("app","Delete")+'" role="button"></a></td></tr>');this.closeHud()}else Craft.cp.displayError(t.error),Garnish.shake(this.hud.$hud)}),this))},closeHud:function(){this.hud.$shade.remove(),this.hud.$hud.remove()}})}(jQuery),function(t){void 0===Craft.CpNav&&(Craft.CpNav={}),t(document).on("change",".layout-select select",(function(){t(this).addClass("loading"),window.location.href=Craft.getUrl("cp-nav?layoutId="+t(this).val())})),t(document).on("click",".add-new-menu-item",(function(e){new Craft.CpNav.AddMenuItem(t(this))}));var e=t(".cp-nav-notice");e.length&&(e.remove(),e.insertAfter("#global-sidebar #system-info").addClass("shown")),Craft.CpNav.AddMenuItem=Garnish.Base.extend({$element:null,data:null,navId:null,$form:null,$cancelBtn:null,$saveBtn:null,$spinner:null,hud:null,init:function(e,a){this.$element=e;var s=e.data("type");this.data={layoutId:t(".layout-select select").val()},this.$element.addClass("loading"),"divider"==s?this.addDivider():Craft.postActionRequest("cp-nav/navigation/get-hud-html",this.data,t.proxy(this,"showHud"))},showHud:function(e,a){if(this.$element.removeClass("loading"),"success"===a){var s=t();this.$form=t("<div/>"),$fieldsContainer=t('<div class="fields"/>').appendTo(this.$form),$fieldsContainer.html(e.bodyHtml),Craft.initUiElements($fieldsContainer);var i=t('<div class="hud-footer"/>').appendTo(this.$form),n=t('<div class="buttons right"/>').appendTo(i);this.$cancelBtn=t('<div class="btn">'+Craft.t("app","Cancel")+"</div>").appendTo(n),this.$saveBtn=t('<input class="btn submit" type="submit" value="'+Craft.t("app","Save")+'"/>').appendTo(n),this.$spinner=t('<div class="spinner hidden"/>').appendTo(n),s=s.add(this.$form),this.hud=new Garnish.HUD(this.$element,s,{bodyClass:"body",closeOtherHUDs:!1}),this.hud.on("hide",t.proxy(this,"closeHud")),new Craft.HandleGenerator("#currLabel","#handle"),Garnish.$bod.append(e.footHtml),this.addListener(this.$saveBtn,"click","saveGroupField"),this.addListener(this.$cancelBtn,"click","closeHud")}},addDivider:function(){this.data.type="divider",this.data.handle="divider",this.data.currLabel=Craft.t("cp-nav","Divider"),Craft.postActionRequest("cp-nav/navigation/new",this.data,t.proxy((function(t,e){"success"===e&&t.success?(Craft.cp.displayNotice(Craft.t("cp-nav","Menu saved.")),s(t.navHtml),this.addNavItem(t.nav)):Craft.cp.displayError(t.error)}),this))},saveGroupField:function(e){e.preventDefault(),this.$spinner.removeClass("hidden");var a=this.hud.$body.serialize();Craft.postActionRequest("cp-nav/navigation/new",a,t.proxy((function(t,e){this.$spinner.addClass("hidden"),"success"===e&&t.success?(Craft.cp.displayNotice(Craft.t("cp-nav","Menu saved.")),s(t.navHtml),this.addNavItem(t.nav),this.closeHud()):(Craft.cp.displayError(t.error),Garnish.shake(this.hud.$hud))}),this))},closeHud:function(){this.hud.$shade.remove(),this.hud.$hud.remove()},addNavItem:function(t){var e=a.addRow('<tr class="nav-item" data-id="'+t.id+'" data-currlabel="'+t.currLabel+'" data-name="'+t.currLabel+'"><td class="thin"><div class="field"><div class="input ltr"><div class="lightswitch on" tabindex="0"><div class="lightswitch-container"><div class="label on"></div><div class="handle"></div><div class="label off"></div></div><input type="hidden" name="navEnabled" value="1"></div></div></div></td><td data-title="'+t.currLabel+'"><a class="move icon" title="'+Craft.t("app","Reorder")+'" role="button"></a><a class="edit-nav">'+t.currLabel+'</a><span class="original-nav">('+t.currLabel+')</span></td><td data-title="'+t.currLabel+'"><span class="original-nav-link">'+(t.url?t.url:"")+'</span></td><td><div class="nav-type"><span class="nav-type-'+t.type+'">'+t.type+'</span></div></td><td class="thin"><a class="delete icon" title="'+Craft.t("app","Delete")+'" role="button"></a></td></tr>');Craft.initUiElements(e)}}),t(document).on("change","#navItems .lightswitch",(function(){var e=t(this).parents("tr.nav-item"),a=t(this).find("input:first").val(),i={value:a=a?1:0,id:e.data("id"),layoutId:t(".layout-select select").val()};Craft.postActionRequest("cp-nav/navigation/toggle",i,t.proxy((function(t,e){"success"===e&&t.success&&(Craft.cp.displayNotice(Craft.t("app","Status saved.")),s(t.navHtml))})))})),t(document).on("click","tr.nav-item a.edit-nav",(function(e){new Craft.CpNav.EditNavItem(t(this),t(this).parents("tr.nav-item"))})),Craft.CpNav.EditNavItem=Garnish.Base.extend({$element:null,data:null,navId:null,$form:null,$cancelBtn:null,$saveBtn:null,$spinner:null,hud:null,init:function(e,a){this.$element=e,this.data={id:a.data("id"),currLabel:a.data("currlabel"),layoutId:t(".layout-select select").val()},this.$element.addClass("loading"),Craft.postActionRequest("cp-nav/navigation/get-hud-html",this.data,t.proxy(this,"showHud"))},showHud:function(e,a){if(this.$element.removeClass("loading"),"success"===a){var s=t();this.$form=t("<div/>"),$fieldsContainer=t('<div class="fields"/>').appendTo(this.$form),$fieldsContainer.html(e.bodyHtml),Craft.initUiElements($fieldsContainer);var i=t('<div class="hud-footer"/>').appendTo(this.$form),n=t('<div class="buttons right"/>').appendTo(i);this.$cancelBtn=t('<div class="btn">'+Craft.t("app","Cancel")+"</div>").appendTo(n),this.$saveBtn=t('<input class="btn submit" type="submit" value="'+Craft.t("app","Save")+'"/>').appendTo(n),this.$spinner=t('<div class="spinner hidden"/>').appendTo(n),s=s.add(this.$form),this.hud=new Garnish.HUD(this.$element,s,{bodyClass:"body",closeOtherHUDs:!1}),this.hud.on("hide",t.proxy(this,"closeHud")),Garnish.$bod.append(e.footHtml),this.addListener(this.$saveBtn,"click","saveGroupField"),this.addListener(this.$cancelBtn,"click","closeHud")}},saveGroupField:function(e){e.preventDefault(),this.$spinner.removeClass("hidden");var a=this.hud.$body.serialize();Craft.postActionRequest("cp-nav/navigation/save",a,t.proxy((function(t,e){this.$spinner.addClass("hidden"),"success"===e&&t.success?(this.$element.html(t.nav.currLabel),this.$element.parents("tr.nav-item").find(".original-nav-link").html(t.nav.url),Craft.cp.displayNotice(Craft.t("app","Menu saved.")),this.closeHud(),s(t.navHtml)):(Craft.cp.displayError(t.error),Garnish.shake(this.hud.$hud))}),this))},closeHud:function(){this.hud.$shade.remove(),this.hud.$hud.remove()}}),Craft.CpNav.AlternateAdminTable=Craft.AdminTable.extend({reorderItems:function(){if(this.settings.sortable){for(var e=[],a=0;a<this.sorter.$items.length;a++){var i=t(this.sorter.$items[a]).attr(this.settings.idAttribute);e.push(i)}var n={ids:JSON.stringify(e),layoutId:t(".layout-select select").val()};Craft.postActionRequest(this.settings.reorderAction,n,t.proxy((function(t,a){"success"===a&&(t.success?(this.onReorderItems(e),Craft.cp.displayNotice(Craft.t("app",this.settings.reorderSuccessMessage)),s(t.navHtml)):Craft.cp.displayError(Craft.t("app",this.settings.reorderFailMessage)))}),this))}},deleteItem:function(e){var a={id:this.getItemId(e),layoutId:t(".layout-select select").val()};Craft.postActionRequest(this.settings.deleteAction,a,t.proxy((function(t,a){"success"===a&&(this.handleDeleteItemResponse(t,e),s(t.navHtml))}),this))}});var a=new Craft.CpNav.AlternateAdminTable({tableSelector:"#navItems",newObjectBtnSelector:"#newNavItem",sortable:!0,reorderAction:"cp-nav/navigation/reorder",deleteAction:"cp-nav/navigation/delete"}),s=function(e){t("#global-sidebar nav#nav ul").html(e),new Craft.CpNav.ModifyItems}}(jQuery),$((function(){}));